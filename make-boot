
if [ "$ARCH" == "" ]
then
    echo "No ARCH evn var defined, bailing out"
    exit
fi 

if [ "$1" == "" ]
then
    echo "No board run provided: run2, run3, run4"
    exit
fi

export PATH=$PATH:$PROJECT/linux-xlnx/build/scripts/dtc/

make ARCH=arm O=build CROSS_COMPILE=arm-xilinx-linux-gnueabi- distclean
make ARCH=arm O=build CROSS_COMPILE=arm-xilinx-linux-gnueabi- clean
make ARCH=arm O=build CROSS_COMPILE=arm-xilinx-linux-gnueabi- zynq_ypacket2_defconfig
make ARCH=arm O=build CROSS_COMPILE=arm-xilinx-linux-gnueabi-
make ARCH=arm O=build CROSS_COMPILE=arm-xilinx-linux-gnueabi- env

cp build/u-boot u-boot.elf

RUN=$1

cat > boot.bif << EOL
the_ROM_image:
{
	[bootloader]../fpga_boot_${RUN}/project_1.sdk/FSBL/Debug/FSBL.elf
        ../fpga_boot_${RUN}/project_1.runs/impl_1/design_1_wrapper.bit
	u-boot.elf
}

EOL

cat boot.bif

bootgen -image boot.bif -w on -o i boot.bin 



if [ "$2" == "jtag" ]
then
    mkdir -p ${RUN}
    cp ../fpga_boot_${RUN}/project_1.sdk/FSBL/Debug/FSBL.elf ${RUN}/
    cp ../fpga_boot_${RUN}/project_1.sdk/project_1_hw_platform_0/design_1_wrapper.bit ${RUN}/
    cp ../fpga_boot_${RUN}/project_1.sdk/project_1_hw_platform_0/ps7_init.tcl ${RUN}/
    sed -i s/-force//g ${RUN}/ps7_init.tcl
    cp u-boot.elf ${RUN}/
    cp boot.bin ${RUN}/boot${RUN:3}.bin
    echo "Run $XMD to load your board using JTAG"
fi



